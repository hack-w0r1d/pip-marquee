<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ«ãƒ¼ãƒ—å†ç”Ÿãƒ†ãƒ­ãƒƒãƒ—å‹•ç”»ã‚µãƒ³ãƒ—ãƒ«</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
</style>
</head>
<body>

<!-- ã“ã“ã«å‹•ç”»ã‚’è¡¨ç¤º -->
<video id="pipVideo" autoplay muted loop playsinline controls style="width:800px; height:100px; margin-bottom:10px;"></video>

<!-- Canvasã§å‹•ç”»ç”Ÿæˆ -->
<canvas id="canvas" width="800" height="100" style="display:none;"></canvas>
<div id="marquee">ã‚­ãƒ³ã‚°ã‚«ãƒ–ãƒ©å‡ºç¾ä¸­ğŸŒˆæ¡ä»¶ãªã—ã”è‡ªç”±ã«ã©ã†ãâ­•ï¸</div>
<button id="startBtn">å‹•ç”»åŒ–é–‹å§‹</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d', { alpha: false });
const marquee = document.getElementById('marquee');
const startBtn = document.getElementById('startBtn');
const video = document.getElementById('pipVideo');

startBtn.addEventListener('click', () => {
  const stream = canvas.captureStream(60); // 60fps
  const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
  const chunks = [];

  recorder.ondataavailable = e => chunks.push(e.data);
  recorder.onstop = e => {
    const blob = new Blob(chunks, { type: 'video/webm' });
    const url = URL.createObjectURL(blob);

    // videoã‚¿ã‚°ã«èª­ã¿è¾¼ã‚“ã§è‡ªå‹•ãƒ«ãƒ¼ãƒ—å†ç”Ÿ
    video.src = url;
    video.play();

    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯ã‚‚ä½œã‚‹
    const a = document.createElement('a');
    a.href = url;
    a.download = 'marquee_video.webm';
    a.textContent = 'å‹•ç”»ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰';
    document.body.appendChild(a);
  };

  recorder.start();

  let x = canvas.width;
  const speed = 2; // æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é€Ÿåº¦
  const text = marquee.textContent;

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'orange';
    ctx.font = '48px sans-serif';
    ctx.fillText(text, x, 70);
    x -= speed;
    if (x < -ctx.measureText(text).width) x = canvas.width;
  }

  let frames = 0;
  const totalFrames = 60 * 10; // 10ç§’å‹•ç”»
  function loop() {
    draw();
    frames++;
    if (frames < totalFrames) requestAnimationFrame(loop);
    else recorder.stop();
  }

  loop();
});
</script>

</body>
</html>
